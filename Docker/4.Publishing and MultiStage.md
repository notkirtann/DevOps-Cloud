# Docker for Developers - Part 4: Publishing at DockerHub and Multi Stage Builds

## What is Docker Hub?
Docker Hub is a cloud-based registry service provided by Docker that allows developers to store, share, and manage Docker images. It serves as a central repository where you can publish your Docker images, making them accessible to others. Docker Hub also provides features such as automated builds, webhooks, and integration with popular CI/CD tools.
## Creating a Docker Hub Account
1. To publish Docker images to Docker Hub, you first need to create an account.
2. Once you have an account, you can create repositories to host your Docker images.
3. Create a new repository by clicking on the "Create Repository" button on your Docker Hub dashboard. Provide a name, description, and visibility settings (public or private) for your repository.
4. After creating the repository, you will be provided with the commands needed to push your Docker images to Docker Hub.
5. Make sure to log in to Docker Hub from your terminal using the following command:
```bash
docker login
```
## Tagging Your Docker Image
Before pushing your Docker image to Docker Hub, you need to tag it with your Docker Hub username and the repository name. The tagging format is as follows:
```bash
docker tag <local_image_name>:<tag> <username>/<repository>:<tag>
```
For example, if your Docker Hub username is `kirtan`, your repository is `my-app`, and your local image is `my-app-image:latest`, you would tag it like this:
```bash
docker tag my-app-image:latest kirtan/my-app:latest
```
## Pushing Your Docker Image to Docker Hub
Once your image is tagged, you can push it to Docker Hub using the following command:
```bash
docker push <username>/<repository>:<tag>
```
For example:
```bash
docker push kirtan/my-app:latest
```
Docker will upload your image to the specified repository on Docker Hub. You can monitor the progress in your terminal.
## Verifying Your Image on Docker Hub
After pushing your image, you can verify that it has been successfully uploaded by visiting your Docker Hub repository page. You should see the new image listed there along with its tags and other details.
## Pulling Your Docker Image from Docker Hub
To use your Docker image on another machine or share it with others, you can pull it from Docker Hub using the following command:
```bash
docker pull <username>/<repository>:<tag>
```
For example:
```bash
docker pull kirtan/my-app:latest
```
This command will download the image to your local machine, allowing you to run containers based on that image.

### Conclusion
Publishing Docker images to Docker Hub is a straightforward process that enables you to share your applications with the world. By following the steps outlined in this guide, you can create a Docker Hub account, tag your images, push them to the repository, and pull them as needed. Docker Hub serves as a powerful platform for collaboration and distribution of containerized applications.

# Docker Multi-Stage Builds
Multi-stage builds are a powerful feature in Docker that allows you to use multiple `FROM` statements in a single Dockerfile. This technique helps to optimize the size of your final Docker image by separating the build environment from the runtime environment. By using multi-stage builds, you can create smaller, more efficient images that contain only the necessary components to run your application.
## Benefits of Multi-Stage Builds
1. **Reduced Image Size**: By separating the build and runtime stages, you can exclude unnecessary build tools and dependencies from the final image, resulting in a smaller footprint.
2. **Improved Security**: A smaller image surface area reduces the attack vectors, enhancing the security of your application.
3. **Simplified Dockerfiles**: Multi-stage builds allow you to keep your Dockerfiles organized and maintainable by clearly defining different stages of the build process.
## Example of a Multi-Stage Build
Here is an example of a multi-stage Dockerfile for a simple Node.js application:

```Dockerfile
# Stage 1: Build Stage
FROM node:22 AS build
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

# Stage 2: Production Stage
FROM node:22-alpine
WORKDIR /app
COPY --from=build /app/dist ./dist
EXPOSE 8000
ENV PORT=8000
CMD ["node", "dist/server.js"]
```

### Security for Multi-Stage Builds
When using multi-stage builds, it's important to consider security best practices:
1. **Use Official Base Images**: Always use official and trusted base images to minimize vulnerabilities.
2. **Minimize Layers**: Combine commands where possible to reduce the number of layers in your image.
3. **Regularly Update Base Images**: Keep your base images up to date with the latest security patches.
4. **Scan Images for Vulnerabilities**: Use tools like Docker Bench for Security or third-party scanners to check your images for known vulnerabilities.

## Permissions in Multi-Stage Builds
When creating multi-stage builds, it's crucial to manage file permissions properly to ensure that the application runs securely. Hereâ€™s an example of how to set permissions in a multi-stage Dockerfile:

```Dockerfile
FROM node:22.22.0-alpine3.23 as base

# Stage 1 of building
FROM base as builder
WORKDIR /project/build

COPY package*.json .
COPY tsconfig.json .

RUN npm install

COPY /src /src

RUN npm run build

# Stage 2
FROM base as runner

WORKDIR /home/app

COPY --from=builder /project/build/dist dist/ 
COPY --from=builder /project/build/package*.json .

RUN npm install --omit=dev

RUN addgroup --system --gid 1001 executer
RUN adduser --system -uid 1001 executer

USER executer

CMD [ "npm","start" ]
```
In this example, we create a non-root user `executer` and switch to that user before running the application. This practice enhances security by limiting the permissions of the application process.
